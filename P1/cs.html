<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Produksi 1 - Cold Storage</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        #sidebar { transition: all 0.3s ease-in-out; }
        .sidebar-closed { transform: translateX(-100%); }
        .main-content { transition: margin-left 0.3s ease-in-out; }
        .text-neon-green { color: #4ade80; }
        .bg-neon-green { background-color: #4ade80; }
        .border-neon-green { border-color: #4ade80; }
        #sheetFrame { transition: opacity 0.3s ease; }
        .loader {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #4ade80;
            border-radius: 50%;
            width: 18px;
            height: 18px;
            animation: spin 1s linear infinite;
            display: none;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body class="bg-gray-100 font-sans overflow-x-hidden">

    <aside id="sidebar" class="fixed top-0 left-0 h-screen w-56 bg-[#1e293b] text-white z-50 shadow-2xl">
        <div class="p-6 text-center">
            <div class="border-2 border-neon-green rounded-md py-1 px-2">
                <span class="text-sm font-black uppercase tracking-tighter text-neon-green">PRODUKSI 1</span>
            </div>
        </div>
        <nav class="mt-4 px-2">
            <a href="index.html" class="flex items-center py-2 px-4 mb-1 hover:bg-slate-700 transition rounded-md text-gray-400 hover:text-white">üè† Home</a>
            <a href="cs.html" class="flex items-center py-2 px-4 mb-1 bg-neon-green text-black font-bold rounded-md shadow-lg">‚ùÑÔ∏è Cold Storage</a>
            <a href="fj.html" class="flex items-center py-2 px-4 mb-1 hover:bg-slate-700 transition rounded-md text-gray-400 hover:text-white">ü•§ Fish Juice</a>
            <a href="fm.html" class="flex items-center py-2 px-4 mb-1 hover:bg-slate-700 transition rounded-md text-gray-400 hover:text-white">üêü Fish Meal</a>
            <a href="rm.html" class="flex items-center py-2 px-4 mb-1 hover:bg-slate-700 transition rounded-md text-gray-400 hover:text-white">üì¶ Raw Material</a>
        </nav>
    </aside>

    <main id="mainContent" class="ml-56 p-4 main-content">
        <header class="flex justify-between items-center mb-6 bg-[#1e293b] text-white p-3 rounded-lg shadow-md border-l-4 border-neon-green">
            <div class="flex items-center">
                <button onclick="toggleSidebar()" class="bg-slate-700 p-2 rounded mr-4 hover:bg-slate-600 transition text-xs">‚ò∞ Menu</button>
                <h1 class="text-xl font-bold">Dashboard <span class="text-neon-green">Cold Storage</span></h1>
            </div>
            <div class="loader" id="loader"></div>
        </header>

        <section class="mb-6 bg-[#1e293b] p-4 rounded-xl shadow-lg border border-slate-700">
            <div class="flex flex-col md:flex-row justify-between items-center mb-4 gap-4">
                <div>
                    <h3 class="text-white font-bold text-sm">Stock Monitoring (MT)</h3>
                    <p class="text-[10px] text-gray-400">Pilih Tab di Bawah Iframe untuk Melihat Data Minggu Lain</p>
                </div>
                <button onclick="forceRefresh()" class="bg-neon-green text-black px-4 py-1 rounded text-[10px] font-black hover:bg-green-400 transition">üîÑ SYNC GRAPH</button>
            </div>
            <div class="h-[220px] w-full">
                <canvas id="lineChart"></canvas>
            </div>
        </section>

        <section class="bg-white rounded-xl shadow-xl border border-gray-200 overflow-hidden">
            <div class="bg-slate-800 p-2 flex justify-between items-center">
                <span class="text-white text-[10px] font-bold px-2 uppercase">Live Google Sheets Table</span>
                <span class="text-neon-green text-[9px] animate-pulse">‚óè Connected</span>
            </div>
            <div class="w-full bg-white">
                <iframe id="sheetFrame" src="" class="w-full h-[600px] border-none"></iframe>
            </div>
        </section>
    </main>

    <script>
        // === HANYA ISI ID INI SAJA ===
        const MY_SHEET_ID = "2PACX-1vRQ6OPRqsuPRmTvAgsJNrU1ISOZ4x-0r1WSmpziuRNdecq42VVxgqferykNrUjJrB-KPWbt_NxgkpFk"; 
        // ============================

        let lineChart;
        const frame = document.getElementById('sheetFrame');
        const loader = document.getElementById('loader');

        function initChart(labels = [], dataPoints = []) {
            const ctx = document.getElementById('lineChart').getContext('2d');
            if (lineChart) { lineChart.destroy(); }
            lineChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels.length ? labels : ['Sen', 'Sel', 'Rab', 'Kam', 'Jum'],
                    datasets: [{
                        label: 'Stock (MT)',
                        data: dataPoints.length ? dataPoints : [0,0,0,0,0],
                        borderColor: '#4ade80',
                        backgroundColor: 'rgba(74, 222, 128, 0.1)',
                        borderWidth: 3,
                        tension: 0.4,
                        fill: true,
                        pointRadius: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: {
                        y: { grid: { color: 'rgba(255,255,255,0.05)' }, ticks: { color: '#94a3b8', font: { size: 10 } } },
                        x: { grid: { display: false }, ticks: { color: '#94a3b8', font: { size: 10 } } }
                    }
                }
            });
        }

        function forceRefresh() {
            loader.style.display = "block";
            const ts = new Date().getTime();
            
            // Link Iframe utama menampilkan SEMUA TAB (otomatis ada tab di bawah)
            frame.src = `https://docs.google.com/spreadsheets/d/e/${MY_SHEET_ID}/pubhtml?widget=true&headers=false&chrome=false&t=${ts}`;
            
            // Grafik akan selalu mengambil data dari sheet PERTAMA (Default)
            // Jika ingin grafik berubah, Anda harus menekan tombol ini setelah pindah tab
            updateChart();
        }

        async function updateChart() {
            try {
                const ts = new Date().getTime();
                // Trik: Kita ambil data tanpa menentukan GID, Google akan kasih sheet pertama/aktif
                const csvUrl = `https://docs.google.com/spreadsheets/d/e/${MY_SHEET_ID}/pub?single=true&range=B2:G3&output=csv&t=${ts}`;
                const response = await fetch(csvUrl);
                const csvData = await response.text();
                const rows = csvData.split('\n').map(row => row.split(','));
                const labels = rows[0].slice(1, 6); 
                const values = rows[1].slice(1, 6).map(v => parseFloat(v.replace(/[^0-9.]/g, '')) || 0);
                initChart(labels, values);
            } catch (e) { console.error(e); initChart(); }
            
            frame.onload = () => { loader.style.display = "none"; };
        }

        window.onload = () => {
            if(MY_SHEET_ID !== "MASUKKAN_ID_ANDA_DISINI") {
                initChart();
                forceRefresh();
            }
        };

        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const mainContent = document.getElementById('mainContent');
            sidebar.classList.toggle('sidebar-closed');
            mainContent.style.marginLeft = sidebar.classList.contains('sidebar-closed') ? "0" : "14rem";
        }
    </script>
</body>
</html>